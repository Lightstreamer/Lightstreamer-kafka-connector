<?xml version="1.0"?>

<!--
    This is the configuration file of the Lightstreamer Kafka Connector pluggable into Lightstreamer Server.


    A very simple variable-expansion feature is available; see
    <enable_expansion_for_adapters_config> in the Server's main configuration file.
-->

<!-- Mandatory. Define the Kafka Connector Adapter Set and its unique ID. -->
<adapters_conf id="KafkaConnector">
    <metadata_provider>
        <!-- Java class name of the Kafka Connector Metadata Adapter. DO NOT EDIT IT. -->
        <adapter_class>com.lightstreamer.kafka_connector.adapters.ConnectorMetadataAdapter</adapter_class>

        <!-- Mandatory. Path of the configuration file for the log4j-based logging system.
             The file path is relative to the Kafka Connector deployment directory.
        -->
        <param name="logging.configuration.path">log4j.properties</param>

    </metadata_provider>

    <data_provider name="QuickStart">
        <adapter_class>com.lightstreamer.kafka_connector.adapters.ConnectorDataAdapter</adapter_class>

        <!-- The Kafka cluster address -->
        <!-- <param name="bootstrap.servers">broker:29094</param> -->
        <param name="bootstrap.servers">kafka-ssl-1:19092</param>
        <param name="group.id">test</param>

        <param name="enabled">true</param>

        <!-- TOPIC MAPPING SECTION -->

        <!-- Define a "sample" item-template, which is simply made of the "sample" item name to be used by the Lighstreamer Client subscription. -->
        <param name="item-template.sample1">sample-#{partition=PARTITION}</param>
        <param name="item-template.sample2">sample</param>

        <!-- Map the Kafka topic "sample-topic" to the previous defined "sample" item template. -->
        <param name="map.sample-topic.to">item-template.sample1,item-template.sample2</param>
        <!--<param name="map.sample-topic2.to">item-template.sample2</param>-->

        <param name="encryption.enable">true</param>
        <!--<param name="encryption.security.protocol">SSL</param>-->
        <!-- <param name="encryption.truststore.path">secrets/kafka.client.truststore.jks1</param>
        <param name="encryption.truststore.password">password</param> -->
        <param name="encryption.truststore.path">secrets/kafka.consumer.truststore.jks</param>
        <param name="encryption.truststore.password">confluent</param>
        <!--<param name="encryption.keystore.enabled">true</param>-->
        <param name="encryption.keystore.path">secrets/kafka.consumer.keystore.jks</param>
        <param name="encryption.keystore.password">confluent</param>

        <!-- FIELDS MAPPING SECTION -->

        <!-- Extraction of the record key mapped to the field "key". -->
        <param name="field.key">#{KEY}</param>

        <!-- Extraction of the record value mapped to the field "value". -->
        <param name="field.value">#{VALUE}</param>

        <!-- Extraction of the record timestamp to the field "ts". -->
        <param name="field.ts">#{TIMESTAMP}</param>

        <!-- Extraction of the record partition mapped to the field "partition". -->
        <param name="field.partition">#{PARTITION}</param>

        <!-- Extraction of the record offset mapped to the field "offset". -->
        <param name="field.offset">#{OFFSET}</param>

        <!---->
    </data_provider>

    <data_provider name="QuickStartSchemaRegisry">
        <adapter_class>com.lightstreamer.kafka_connector.adapters.ConnectorDataAdapter</adapter_class>

        <!-- The Kafka cluster address -->
        <param name="bootstrap.servers">pkc-z9doz.eu-west-1.aws.confluent.cloud:9092</param>

        <param name="group.id">test</param>

        <param name="enabled">true</param> -->

        <!-- TOPIC MAPPING SECTION -->

        <!-- Define a "sample" item-template, which is simply made of the "sample" item name to be used by the Lighstreamer Client subscription. -->
        <!-- <param name="item-template.sample1">sample-#{partition=PARTITION}</param>
        <param name="item-template.sample2">sample</param> -->
        <param name="item-template.sample2">sample-#{key=KEY}</param>

        <!-- Map the Kafka topic "sample-topic" to the previous defined "sample" item template. -->
        <param name="map.topic_0.to">item-template.sample1,item-template.sample2</param>

        <param name="value.evaluator.type">AVRO</param>
        <param name="value.evaluator.schema.registry">AVRO</param>
        
        <param name="schema.registry.url">https://localhost:8081</param>

        <param name="schema.registry.encryption.truststore.path">secrets/kafka.client.truststore.jks</param>
        <param name="schema.registry.encryption.truststore.password">password</param>
        <param name="schema.registry.encryption.truststore.password">password</param>

        <param name="schema.registry.encryption.keystore.enabled">true</param>
        <param name="schema.registry.encryption.keystore.path">secrets/kafka.consumer.keystore.jks</param>
        <param name="schema.registry.encryption.keystore.password">confluent</param>

        <param name="schema.registry.basic.authentication.enabled">true</param>
        <param name="schema.registry.basic.authentication.username">true</param>
        <param name="schema.registry.basic.authentication.passowrd">true</param>


        <param name="encryption.enabled">true</param>
        <!-- <param name="encryption.truststore.path">secrets/kafka.client.truststore.jks1</param>
        <param name="encryption.truststore.password">password</param> -->

        <!-- <param name="authentication.enabled">true</param>
        <param name="authentication.username">R5QP6BKBEHPRHEI5</param>
        <param name="authentication.password">phXcJCcvpcynTwlLJk81XwAeVPyLyKnzmTh/VTXV5kXqyGrEGyvF/sm3btq79A4Y</param> -->

        <!-- FIELDS MAPPING SECTION -->

        <!-- Extraction of the record key mapped to the field "key". -->
        <param name="field.key">#{KEY}</param>

        <!-- Extraction of the record value mapped to the field "value". -->
        <param name="field.value">#{VALUE}</param>

        <!-- Extraction of the record timestamp to the field "ts". -->
        <param name="field.ts">#{TIMESTAMP}</param>

        <!-- Extraction of the record partition mapped to the field "partition". -->
        <param name="field.partition">#{PARTITION}</param>

        <!-- Extraction of the record offset mapped to the field "offset". -->
        <param name="field.offset">#{OFFSET}</param>

    <!-- </data_provider>  -->

</adapters_conf>

